!function(){"use strict";var a=angular.module("selectionTree",["ngMaterial"]);a.directive("selectionTree",function(){var a='<div layout="row" layout-align="start center">             <div id="field" ng-class="{readonly: readonly, withData: data && !readonly, withoutData: !data && !readonly}" class="form-control" ng-click="!readonly && search($event)" flex>                 <span class="chip" ng-if="multiple" ng-repeat="result in results">{{ result.text }} <i ng-if="!readonly" class="fa fa-remove" ng-click="remove(result)"/></span>                 <span class="chip" ng-if="!multiple && results.text">{{ results.text }} <i ng-if="!readonly" class="fa fa-remove" ng-click="remove(result)"/></span>                 <input ng-show="!data" id="textfield" type="text" style="border: 0 solid transparent; background-color: transparent">             </div>             <md-button ng-if="data && false" class="md-primary md-fab md-mini" ng-click="search()"><i class="fa fa-search" /></md-button>         </div>';return{restrict:"E",template:a,require:"ngModel",scope:{data:"=data",multiple:"=multiple",required:"=required",readonly:"=ngReadonly",filterText:"@filterText"},link:function(a,b,c,d){var e=this;d.$render=function(){a.results=d.$modelValue,!a.required||a.results&&0!=a.results.length||$(b.find("#field")).addClass("ng-invalid").addClass("ng-invalid-required")},d.$validators.selectionTree=function(b,c){return!a.required||(!!(a.multiple&&b&&b.length>0)||!(a.multiple||!b))};var f=["data","maxHeight","width",function(c,f,g){a._timeout(function(){$("#STcontainer").css("min-width",g+"px"),$("#STcontainer").css("max-height",f+"px"),$("#STjstree").jstree({core:{themes:{stripes:!0},check_callback:!0,force_text:!0,data:c},plugins:["wholerow","sort","search"]}).on("changed.jstree",function(c,f){if(a.multiple){a.results||(a.results=[],d.$setViewValue(a.results));var g=!1;if(angular.forEach(a.results,function(a){a.id==f.node.id&&(g=!0)}),!g){var h=angular.copy(f.node);delete h.children,delete h.children_d,delete h.a_attr,delete h.data,delete h.icon,delete h.li_attr,delete h.original,delete h.parent,delete h.parents,delete h.state,a.results.push(h),d.$setViewValue(a.results),$(b.find("#field")).removeClass("ng-invalid").removeClass("ng-invalid-required")}}else a.results=angular.copy(f.node),delete a.results.children,delete a.results.children_d,delete a.results.a_attr,delete a.results.data,delete a.results.icon,delete a.results.li_attr,delete a.results.original,delete a.results.parent,delete a.results.parents,delete a.results.state,d.$setViewValue(a.results),$(b.find("#field")).removeClass("ng-invalid").removeClass("ng-invalid-required"),e.panelRef.close()});var h=!1;$("#STfilter").focus(),$("#STfilter").keyup(function(){h&&clearTimeout(h),h=setTimeout(function(){var a=$("#STfilter").val();$("#STjstree").jstree(!0).search(a)},250)})},0)}];a.remove=function(c){a.multiple?(a.results.splice(a.results.indexOf(c),1),d.$setViewValue(a.results),0==a.results.length&&a.required&&$(b.find("#field")).addClass("ng-invalid").addClass("ng-invalid-required")):(a.results=null,d.$setViewValue(null),a.required&&$(b.find("#field")).addClass("ng-invalid").addClass("ng-invalid-required"))},$(b.find("#textfield")).keyup(function(c){if(13==c.keyCode&&0!=$(b.find("#textfield")).val().length){a.results||(a.results=[]);var e=!1;angular.forEach(a.results,function(a){a.text==$(b.find("#textfield")).val()&&(e=!0)}),e||(a.results.push({text:$(b.find("#textfield")).val()}),d.$setViewValue(a.results),$(b.find("#field")).removeClass("ng-invalid").removeClass("ng-invalid-required"),$(b.find("#textfield")).val(""))}}),a.filterText||(a.filterText="filter");var g='<div id="STcontainer" style="background-color: #e6e6e6; border: 2px solid #c5c5c5; overflow-y: auto; overflow-x: hidden; padding-right: 20px;">             <input type="text" class="form-control" id="STfilter" placeholder="'+a.filterText+'" style="margin-bottom:10px">             <div id="STjstree"></div>         </div>';a.search=function(c){if(!a.data)return void b.find("#textfield").focus();if(!c||!$(c.target).hasClass("chip")&&!$(c.target).hasClass("fa")){var d,h,i=$(b.find("#field")).outerWidth(),j=$(window).height()-($(b.find("#field")).offset().top+$(b.find("#field")).outerHeight())-20,k=$(b.find("#field")).offset().top-20;j>200||j>k?(h=a._mdPanel.newPanelPosition().relativeTo(b.find("#field")).left($(b.find("#field")).offset().left).top($(b.find("#field")).offset().top+$(b.find("#field")).outerHeight()),d=j):(h=a._mdPanel.newPanelPosition().relativeTo(b.find("#field")).left($(b.find("#field")).offset().left).bottom($(window).height()-$(b.find("#field")).offset().top),d=k),a.width=i;var l={attachTo:angular.element(document.body),controller:f,locals:{data:a.data,maxHeight:d,width:i},template:g,position:h,clickOutsideToClose:!0,escapeToClose:!0,focusOnOpen:!1,zIndex:100};e.panelRef=a._mdPanel.create(l),e.panelRef.open()}}},controller:["$scope","$mdPanel","$timeout",function(a,b,c){a._mdPanel=b,a._timeout=c}]}})}();