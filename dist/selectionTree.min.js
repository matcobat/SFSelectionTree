!function(){"use strict";var a=angular.module("selectionTree",["ngMaterial"]);a.directive("selectionTree",["$timeout",function(a){var b='<div ng-if="multiple" layout="row" layout-align="start center">                             <div id="field" ng-class="{readonly: readonly, withData: data && !readonly, withoutData: !data && !readonly}" class="multiple-field form-control" ng-click="!readonly && search($event)" flex>                                 <span class="chip" ng-if="multiple" ng-repeat="result in results">{{ result.text }} <i ng-if="!readonly" class="fa fa-remove" ng-click="remove(result)"/></span>                                 <span class="chip" ng-if="!multiple && results.text">{{ results.text }} <i ng-if="!readonly" class="fa fa-remove" ng-click="remove()"/></span>                                 <input ng-show="!data" id="textfield" type="text" style="border: 0 solid transparent; background-color: transparent">                             </div>                             <md-button ng-if="data && false" class="md-primary md-fab md-mini" ng-click="search()"><i class="fa fa-search" /></md-button>                         </div>                         <div ng-if="!multiple" class="input-group">                                 <p class="form-control" id="field">{{ results.text }}</p>                                 <span class="input-group-btn">                             <button class="btn btn-danger" type="button" ng-click="remove()" ng-if="!required"><i class="fa fa-times"/></button>                             <button class="btn btn-primary" type="button" ng-click="search()"><i class="fa fa-search"/></button>                         </div>';return{restrict:"E",template:b,require:"ngModel",scope:{data:"=data",multiple:"=multiple",required:"=required",readonly:"=ngReadonly",filterText:"@filterText"},link:function(b,c,d,e){var f=this;e.$render=function(){b.results=e.$modelValue,!b.required||b.results&&0!=b.results.length||a(function(){$(c.find("#field")).addClass("ng-invalid").addClass("ng-invalid-required")})},e.$validators.selectionTree=function(a,c){return!b.required||(!!(b.multiple&&a&&a.length>0)||!(b.multiple||!a))};var g=["data","maxHeight","width",function(a,d,g){b._timeout(function(){$("#STcontainer").css("min-width",g+"px"),$("#STcontainer").css("max-height",d+"px"),$("#STjstree").jstree({core:{themes:{stripes:!0},check_callback:!0,force_text:!0,data:a},plugins:["wholerow","sort","search"]}).on("changed.jstree",function(a,d){if(b.multiple){b.results||(b.results=[],e.$setViewValue(b.results));var g=!1;if(angular.forEach(b.results,function(a){a.id==d.node.id&&(g=!0)}),!g){var h=angular.copy(d.node);delete h.children,delete h.children_d,delete h.a_attr,delete h.data,delete h.icon,delete h.li_attr,delete h.original,delete h.parent,delete h.parents,delete h.state,b.results.push(h),e.$setViewValue(b.results),$(c.find("#field")).removeClass("ng-invalid").removeClass("ng-invalid-required")}}else b.results=angular.copy(d.node),delete b.results.children,delete b.results.children_d,delete b.results.a_attr,delete b.results.data,delete b.results.icon,delete b.results.li_attr,delete b.results.original,delete b.results.parent,delete b.results.parents,delete b.results.state,e.$setViewValue(b.results),$(c.find("#field")).removeClass("ng-invalid").removeClass("ng-invalid-required"),f.panelRef.close()});var h=!1;$("#STfilter").focus(),$("#STfilter").keyup(function(){h&&clearTimeout(h),h=setTimeout(function(){var a=$("#STfilter").val();$("#STjstree").jstree(!0).search(a)},250)})},0)}];b.remove=function(a){b.multiple?(b.results.splice(b.results.indexOf(a),1),e.$setViewValue(b.results),0==b.results.length&&b.required&&$(c.find("#field")).addClass("ng-invalid").addClass("ng-invalid-required")):(b.results=null,e.$setViewValue(null),b.required&&$(c.find("#field")).addClass("ng-invalid").addClass("ng-invalid-required"))},$(c.find("#textfield")).keyup(function(a){if(13==a.keyCode&&0!=$(c.find("#textfield")).val().length){b.results||(b.results=[]);var d=!1;angular.forEach(b.results,function(a){a.text==$(c.find("#textfield")).val()&&(d=!0)}),d||(b.results.push({text:$(c.find("#textfield")).val()}),e.$setViewValue(b.results),$(c.find("#field")).removeClass("ng-invalid").removeClass("ng-invalid-required"),$(c.find("#textfield")).val(""))}}),b.filterText||(b.filterText="filter");var h='<div id="STcontainer" style="background-color: #e6e6e6; border: 2px solid #c5c5c5; overflow-y: auto; overflow-x: hidden; padding-right: 20px;">             <input type="text" class="form-control" id="STfilter" placeholder="'+b.filterText+'" style="margin-bottom:10px">             <div id="STjstree"></div>         </div>';b.search=function(a){if(!b.data)return void c.find("#textfield").focus();if(!a||!$(a.target).hasClass("chip")&&!$(a.target).hasClass("fa")){var d,e,i=$(c.find("#field")).outerWidth(),j=$(window).height()-($(c.find("#field")).offset().top+$(c.find("#field")).outerHeight())-20,k=$(c.find("#field")).offset().top-20;j>200||j>k?(e=b._mdPanel.newPanelPosition().relativeTo(c.find("#field")).left($(c.find("#field")).offset().left+"px").top($(c.find("#field")).offset().top+$(c.find("#field")).outerHeight()+"px"),d=j):(e=b._mdPanel.newPanelPosition().relativeTo(c.find("#field")).left($(c.find("#field")).offset().left+"px").bottom($(window).height()-$(c.find("#field")).offset().top+"px"),d=k),b.width=i;var l={attachTo:angular.element(document.body),controller:g,locals:{data:b.data,maxHeight:d,width:i},template:h,position:e,clickOutsideToClose:!0,escapeToClose:!0,focusOnOpen:!1,zIndex:100};f.panelRef=b._mdPanel.create(l),f.panelRef.open()}}},controller:["$scope","$mdPanel","$timeout",function(a,b,c){a._mdPanel=b,a._timeout=c}]}}])}();